---
layout: base.njk
---

<article class="container mx-auto px-4 py-8" id="scrollspy-scrollable-parent">
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumbs mb-2 px-4 sm:px-8 md:px-12 lg:px-20 text-sm">
    <ol>
      <li>
        <a href="/" class="flex items-center gap-2">
          <span class="icon-[tabler--home] size-5"></span>
          Home
        </a>
      </li>
      <li class="breadcrumbs-separator rtl:rotate-180">
        <span class="icon-[tabler--chevron-right]"></span>
      </li>
      <li>
        <a href="/posts/" class="flex items-center gap-2">
          <span class="icon-[tabler--article] size-5"></span>
          Blog
        </a>
      </li>
      <li class="breadcrumbs-separator rtl:rotate-180">
        <span class="icon-[tabler--chevron-right]"></span>
      </li>
      <li aria-current="page" class="flex items-center gap-2">
        <span class="icon-[tabler--file-text] size-5"></span>
        <span class="hidden sm:inline">{{ title }}</span>
        <span class="sm:hidden">Article</span>
      </li>
    </ol>
  </div>

  <!-- Hero Section -->
  <section class="flex items-center py-8 sm:py-12 md:py-16">
    <div class="w-full px-4 sm:px-8 md:px-12 lg:px-20">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-center">
        <!-- Left Content -->
        <div class="space-y-6 md:space-y-8">
          <div class="space-y-4">
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3">
              {% if nft_metadata %}
                <span class="badge badge-primary">NFT Music</span>
              {% endif %}
              <span class="badge badge-soft bg-primary/10 text-primary">New Article</span>
              <span class="text-sm text-secondary">By {{ author }}</span>
            </div>
            <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-tight text-primary">
              {{ title }}
            </h1>
            {% if meta_description %}
              <p class="text-base sm:text-lg md:text-xl text-secondary/80 max-w-lg">
                {{ meta_description }}
              </p>
            {% endif %}
          </div>

          <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
            <div class="flex items-center gap-4 text-sm text-secondary">
              <div class="flex items-center gap-2">
                <span class="icon-[tabler--calendar] size-4 text-primary"></span>
                <time datetime="{{ published_date }}">
                  {{ published_date | date("MMMM D, YYYY") }}
                </time>
              </div>
              <div class="flex items-center gap-2">
                <span class="icon-[tabler--clock] size-4 text-primary"></span>
                <span>{% set words = content | wordcount %}{% set minutes = (words / 200) | round(0, 'ceil') %}{{ minutes }} min read</span>
              </div>
            </div>
            
            <!-- Listen to Article Button -->
            <button id="listen-to-article" 
                    x-show="$store.tts && $store.tts.isInitialized"
                    class="btn btn-primary btn-sm gap-2 w-fit transition-all hover:transform hover:-translate-y-1" 
                    @click="$store.tts.show()"
                    style="display: none;">
              <span class="icon-[tabler--headphones] size-4"></span>
              Listen to Article
            </button>
          </div>

          {% if tags %}
            <div class="flex flex-wrap gap-2">
              {% for tag in tags %}
                <span class="badge bg-primary/10 text-primary hover:bg-primary/20">
                  {{ tag }}
                </span>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <!-- Right Content - Hero Image -->
        <div class="relative h-[400px] md:h-[500px] w-full rounded-2xl overflow-hidden">
          {% set firstImage = content | extractFirstImage %}
          {% if firstImage %}
            <img src="{{ firstImage.src | transformImage(true) }}" alt="{{ firstImage.alt }}" class="w-full h-full object-cover cursor-pointer" data-original-src="{{ firstImage.src }}" loading="lazy"/>
          {% else %}
            <img src="https://picsum.photos/800/500" alt="Hero image" class="w-full h-full object-cover cursor-pointer" data-original-src="https://picsum.photos/800/500" loading="lazy"/>
          {% endif %}
          <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-primary/80 to-transparent">
            <p class="text-white text-sm">
              All images are generated by <a href="https://openai.com/dall-e" target="_blank" rel="noopener noreferrer" class="underline hover:text-secondary">OpenAI DALL-E</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Text-to-Speech Player -->
  <div x-data="{ ttsPlayerDebug: false }" x-init="$watch('$store.tts.isPlayerVisible', value => { ttsPlayerDebug = value; console.log('TTS Player visibility changed:', value); })">
    <!-- Floating Audio Player -->
    <div x-show="$store.tts && $store.tts.isPlayerVisible" 
         x-transition:enter="transition ease-out duration-300 transform"
         x-transition:enter-start="translate-y-full opacity-0"
         x-transition:enter-end="translate-y-0 opacity-100"
         x-transition:leave="transition ease-in duration-200 transform"
         x-transition:leave-start="translate-y-0 opacity-100"
         x-transition:leave-end="translate-y-full opacity-0"
         class="fixed bottom-4 z-50 bg-base-100 shadow-xl rounded-lg border border-primary/20 backdrop-blur-md left-4 right-4 sm:left-auto sm:right-4 sm:w-96"
         style="display: none;">
      
      <div class="p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold text-primary flex items-center gap-2">
            <span class="icon-[tabler--volume] size-5"></span>
            Listen to Article
          </h3>
          <button @click="$store.tts.hide()" class="btn btn-circle btn-sm btn-ghost">
            <span class="icon-[tabler--x] size-4"></span>
          </button>
        </div>
        
        <div class="space-y-3">
          <!-- Progress bar -->
          <div class="w-full">
            <div class="flex justify-between text-xs text-secondary mb-1">
              <span x-text="$store.tts.currentTime"></span>
              <span x-text="$store.tts.totalTime"></span>
            </div>
            <div class="w-full bg-base-300 rounded-full h-2">
              <div class="bg-gradient-to-r from-primary to-secondary h-2 rounded-full transition-all duration-300" 
                   :style="`width: ${$store.tts.progressWidth}`"></div>
            </div>
          </div>

          <!-- Main controls -->
          <div class="flex items-center justify-center gap-2">
            <button @click="$store.tts.previous()" 
                    :disabled="!$store.tts.canGoPrevious"
                    class="btn btn-circle btn-sm btn-ghost transition-all"
                    :class="{ 'opacity-50 cursor-not-allowed': !$store.tts.canGoPrevious }">
              <span class="icon-[tabler--player-skip-back] size-4"></span>
            </button>
            
            <button @click="$store.tts.togglePlayPause()" 
                    class="btn btn-circle btn-primary shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
              <span :class="$store.tts.playButtonIcon + ' size-5'"></span>
            </button>
            
            <button @click="$store.tts.next()" 
                    :disabled="!$store.tts.canGoNext"
                    class="btn btn-circle btn-sm btn-ghost transition-all"
                    :class="{ 'opacity-50 cursor-not-allowed': !$store.tts.canGoNext }">
              <span class="icon-[tabler--player-skip-forward] size-4"></span>
            </button>
          </div>

          <!-- Settings -->
          <div class="flex items-center justify-between text-sm">
            <div class="flex items-center gap-2">
              <span class="icon-[tabler--gauge] size-4 text-secondary"></span>
              <span class="text-secondary">Speed:</span>
              <select x-model="$store.tts.playbackRate" 
                      @change="$store.tts.updateSettings()"
                      data-select='{
                        "placeholder": "1x",
                        "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
                        "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-1 px-2 pe-6 flex gap-x-1 text-nowrap w-16 cursor-pointer bg-base-200 border border-base-300 rounded text-start text-xs focus:outline-none focus:ring-1 focus:ring-primary",
                        "dropdownClasses": "mb-1 bottom-full max-h-48 pb-1 px-1 space-y-0.5 z-50 w-20 bg-base-100 border border-base-300 rounded overflow-hidden overflow-y-auto shadow-lg",
                        "optionClasses": "py-1 px-2 w-full text-xs text-base-content cursor-pointer hover:bg-base-200 rounded focus:outline-none focus:bg-base-200",
                        "extraMarkup": "<div class=\"absolute top-1/2 end-1 -translate-y-1/2\"><svg class=\"shrink-0 size-2.5 text-base-content\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m7 15 5 5 5-5\"/><path d=\"m7 9 5-5 5 5\"/></svg></div>"
                      }'
                      class="hidden">
                <option value="0.5">0.5x</option>
                <option value="0.75">0.75x</option>
                <option value="1">1x</option>
                <option value="1.25">1.25x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
              </select>
            </div>
            
            <button data-overlay="#tts-settings-modal" class="btn btn-circle btn-xs btn-ghost">
              <span class="icon-[tabler--settings] size-3"></span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Debug info (remove in production) -->
    <div x-show="ttsPlayerDebug" class="fixed bottom-4 left-4 bg-red-500 text-white p-2 text-xs rounded">
      Player should be visible
    </div>

    <!-- Settings Modal -->
    <div id="tts-settings-modal" class="overlay modal overlay-open:opacity-100 overlay-open:duration-300 hidden" role="dialog" tabindex="-1" data-overlay-options='{"backdropClasses": "transition duration-300 fixed inset-0 bg-black/50 overlay-backdrop"}'>
      <div class="modal-dialog overlay-open:opacity-100 overlay-open:duration-300">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Audio Settings</h3>
            <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close" data-overlay="#tts-settings-modal">
              <span class="icon-[tabler--x] size-4"></span>
            </button>
          </div>
          
          <div class="modal-body space-y-6">
            <!-- Voice Selection -->
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">Voice</span>
              </label>
              <div class="relative">
                <select x-model="$store.tts.selectedVoiceIndex" 
                        @change="$store.tts.updateSettings()"
                        data-select='{
                          "placeholder": "Select a voice...",
                          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
                          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-3 ps-4 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-base-100 border border-base-300 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-primary",
                          "dropdownClasses": "mt-2 max-h-72 pb-1 px-1 space-y-0.5 z-20 w-full bg-base-100 border border-base-300 rounded-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-base-200 [&::-webkit-scrollbar-thumb]:bg-base-300",
                          "optionClasses": "py-2 px-4 w-full text-sm text-base-content cursor-pointer hover:bg-base-200 rounded-lg focus:outline-none focus:bg-base-200",
                          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span></div>",
                          "extraMarkup": "<div class=\"absolute top-1/2 end-3 -translate-y-1/2\"><svg class=\"shrink-0 size-3.5 text-base-content\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m7 15 5 5 5-5\"/><path d=\"m7 9 5-5 5 5\"/></svg></div>"
                        }'
                        class="hidden">
                  <option value="" disabled>Select a voice...</option>
                  <template x-for="(voice, index) in $store.tts.voices" :key="index">
                    <option :value="index" x-text="`${voice.name} (${voice.lang})`"></option>
                  </template>
                </select>
              </div>
            </div>
            
            <!-- Playback Speed -->
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">Playback Speed</span>
              </label>
              <div class="relative">
                <select x-model="$store.tts.playbackRate" 
                        @change="$store.tts.updateSettings()"
                        data-select='{
                          "placeholder": "Select speed...",
                          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
                          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-3 ps-4 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-base-100 border border-base-300 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-primary",
                          "dropdownClasses": "mt-2 max-h-72 pb-1 px-1 space-y-0.5 z-20 w-full bg-base-100 border border-base-300 rounded-lg overflow-hidden overflow-y-auto",
                          "optionClasses": "py-2 px-4 w-full text-sm text-base-content cursor-pointer hover:bg-base-200 rounded-lg focus:outline-none focus:bg-base-200",
                          "extraMarkup": "<div class=\"absolute top-1/2 end-3 -translate-y-1/2\"><svg class=\"shrink-0 size-3.5 text-base-content\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m7 15 5 5 5-5\"/><path d=\"m7 9 5-5 5 5\"/></svg></div>"
                        }'
                        class="hidden">
                  <option value="0.5">0.5x (Slow)</option>
                  <option value="0.75">0.75x</option>
                  <option value="1">1x (Normal)</option>
                  <option value="1.25">1.25x</option>
                  <option value="1.5">1.5x</option>
                  <option value="2">2x (Fast)</option>
                </select>
              </div>
            </div>
            
            <!-- Pitch Control -->
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">Voice Pitch</span>
                <span class="label-text-alt font-mono text-primary" x-text="$store.tts.pitch"></span>
              </label>
              <div class="px-1">
                <input x-model="$store.tts.pitch" 
                       @input="$store.tts.updateSettings()"
                       type="range" 
                       min="0.5" 
                       max="2" 
                       step="0.1" 
                       class="range range-primary w-full"
                       aria-label="Voice pitch control"/>
                <div class="w-full flex justify-between text-xs px-2 mt-2 text-base-content/70">
                  <span>0.5</span>
                  <span>1.0</span>
                  <span>1.5</span>
                  <span>2.0</span>
                </div>
                <div class="w-full flex justify-between text-xs px-2 text-base-content/60">
                  <span>Lower</span>
                  <span>Normal</span>
                  <span>Higher</span>
                  <span>Highest</span>
                </div>
              </div>
            </div>

            <!-- Settings Checkboxes -->
            <div class="space-y-4">
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text font-medium">Highlight text while reading</span>
                  <input x-model="$store.tts.highlightText" 
                         type="checkbox" 
                         class="checkbox checkbox-primary"/>
                </label>
                <div class="label">
                  <span class="label-text-alt text-base-content/70">Visually highlight the current text being read</span>
                </div>
              </div>

              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text font-medium">Auto-scroll to current text</span>
                  <input x-model="$store.tts.autoScroll" 
                         type="checkbox" 
                         class="checkbox checkbox-primary"/>
                </label>
                <div class="label">
                  <span class="label-text-alt text-base-content/70">Automatically scroll to follow the reading progress</span>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-soft btn-secondary" data-overlay="#tts-settings-modal">Close</button>
            <button type="button" class="btn btn-primary" @click="$store.tts.testVoice($store.tts.selectedVoiceIndex)">
              <span class="icon-[tabler--volume] size-4 mr-2"></span>
              Test Voice
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Scrollspy -->
  <aside class="md:hidden w-full mb-8">
    <div class="card bg-base-200 shadow-base-300/20 shadow-sm mx-4 sm:mx-8 md:mx-12 lg:mx-20">
      <div class="card-body p-4 sm:p-6">
        <div class="overflow-y-auto max-h-[calc(100vh-4rem)]">
          <ul class="menu menu-sm gap-1 bg-base-200" x-data="scrollspy" data-scrollspy="#scrollspy" data-scrollspy-scrollable-parent="#scrollspy">
            <li class="text-base-content text-xl font-medium">Table of Contents</li>
            {% for heading in content | toc %}
              {% if heading.level == 2 %}
                <li data-scrollspy-group="">
                  <a href="#{{ heading.id }}" 
                     class="text-primary hover:text-primary block py-0.5 font-medium"
                     :class="{ 'scrollspy-active:text-primary': isActive('#{{ heading.id }}') }">
                    {{ heading.text }}
                  </a>
                  {% if heading.children %}
                    <ul>
                      {% for child in heading.children %}
                        <li class="ms-0.5 sm:ms-4">
                          <a href="#{{ child.id }}" 
                             class="text-secondary/80 hover:text-primary flex items-center gap-x-2 py-0.5"
                             :class="{ 'scrollspy-active:text-primary': isActive('#{{ child.id }}') }">
                            <span class="icon-[tabler--point] size-4 text-secondary"></span>
                            {{ child.text }}
                          </a>
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </aside>

  <div class="container mx-auto px-4 sm:px-8 md:px-12 lg:px-20">
    <div class="flex flex-col md:flex-row gap-12">
      <!-- Main content -->
      <div class="w-full md:w-3/5 order-1">
        <div class="bg-base-100">
          <div id="scrollspy" class="prose prose-base-content max-w-none prose-headings:text-primary prose-h3:text-secondary prose-p:text-base-content/90 prose-a:text-primary hover:prose-a:text-secondary prose-strong:text-primary prose-code:text-primary prose-pre:bg-primary/5 prose-pre:text-base-content" x-data="imageModal">
            <style>
              /* Mobile styles - all images 320x240 */
              .prose h2 + p > img {
                width: 100%;
                height: 240px;
                object-fit: cover;
                border-radius: 0.5rem;
                margin-bottom: 2rem;
                cursor: pointer;
              }

              /* Desktop styles */
              @media (min-width: 768px) {
                /* Other images (after h2) */
                .prose h2 + p > img {
                  width: 320px;
                  height: 240px;
                }

                /* Float positioning */
                .prose h2:nth-of-type(odd) + p > img {
                  float: right;
                  margin-left: 2rem;
                }
                .prose h2:nth-of-type(even) + p > img {
                  float: left;
                  margin-right: 2rem;
                }
              }
            </style>
            {% if firstImage %}
              {{ firstImage.content | transformContentImages | safe }}
            {% else %}
              {{ content | transformContentImages | safe }}
            {% endif %}
          </div>

          <!-- Image Modal -->
          <div id="imageModal" class="overlay modal modal-middle overlay-open:opacity-100 hidden overlay-open:duration-300" role="dialog" tabindex="-1">
            <div class="fixed inset-0 bg-black/50"></div>
            <div class="relative z-10 flex items-center justify-center min-h-screen">
              <div class="card bg-base-100 shadow-lg shadow-base-300/20">
                <div class="card-body p-0">
                  <img id="modalImage" src="" alt="" class="w-full h-full object-contain" loading="lazy"/>
                </div>
              </div>
            </div>
          </div>

          <!-- Comments Section -->
          <section class="mt-12 pt-8 border-t border-primary/10">
            <h2 class="text-2xl font-bold text-primary mb-6">Comments</h2>

            <!-- Comment Form -->
            <div class="card bg-base-200 shadow-base-300/20 shadow-sm mb-8">
              <div class="card-body">
                <form class="space-y-4">
                  <div class="form-control">
                    <label class="label">
                      <span class="label-text text-primary">Name</span>
                    </label>
                    <input type="text" placeholder="Your name" class="input input-bordered"/>
                  </div>
                  <div class="form-control">
                    <label class="label">
                      <span class="label-text text-primary">Email</span>
                    </label>
                    <input type="email" placeholder="Your email" class="input input-bordered"/>
                  </div>
                  <div class="form-control">
                    <label class="label">
                      <span class="label-text text-primary">Comment</span>
                    </label>
                    <textarea class="textarea textarea-bordered h-24" placeholder="Write your comment here..."></textarea>
                  </div>
                  <button class="btn btn-primary">Post Comment</button>
                </form>
              </div>
            </div>

            {% if comments %}
              <!-- Featured Comment -->
              {% set featuredComment = comments | random %}
              <div class="card bg-base-200 shadow-base-300/20 shadow-sm mb-6">
                <div class="card-body">
                  <div class="flex items-start gap-4">
                    <div class="avatar">
                      <div class="w-10 h-10 rounded-full">
                        <img src="{{ featuredComment.avatar }}" alt="{{ featuredComment.name }}" loading="lazy"/>
                      </div>
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-primary">{{ featuredComment.name }}</h3>
                        <span class="text-sm text-secondary">{{ featuredComment.published_date | date("MMM d, yyyy h:mma") }}</span>
                      </div>
                      <p class="mt-2 text-base-content/90">{{ featuredComment.text }}</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Read More Comments Button -->
              <div class="flex justify-center">
                <button type="button" class="btn btn-primary" data-overlay="#overlay-comments">
                  <span class="icon-[tabler--message-circle] size-5 me-2"></span>
                  Read More Comments
                </button>
              </div>
            {% else %}
              <div class="text-center py-8">
                <p class="text-secondary">No comments yet. Be the first to comment!</p>
              </div>
            {% endif %}
          </section>

          <!-- Comments Drawer -->
          <div id="overlay-comments" class="max-w-lg overlay overlay-open:translate-x-0 drawer drawer-end backdrop-blur-sm bg-base-100/80 hidden" role="dialog" tabindex="-1" data-overlay-options='{"backdropClasses": "transition duration-300 fixed inset-0 bg-black/50 overlay-backdrop", "drawerClasses": "transition duration-300 fixed inset-y-0 end-0 z-50 w-80 bg-base-100 shadow-lg"}'>
            <div class="drawer-header border-b border-base-300/20">
              <h3 class="drawer-title text-primary">All Comments</h3>
              <button type="button" class="btn btn-text btn-circle btn-sm absolute end-3 top-3" aria-label="Close" data-overlay="#overlay-comments">
                <span class="icon-[tabler--x] size-5"></span>
              </button>
            </div>
            <div class="drawer-body">
              <div class="space-y-6">
                <!-- Comments List -->
                <div class="space-y-6">
                  {% for comment in comments %}
                    <div class="card bg-base-200 shadow-base-300/20 shadow-sm">
                      <div class="card-body">
                        <div class="flex items-start gap-4">
                          <div class="avatar">
                            <div class="w-10 h-10 rounded-full">
                              <img src="{{ comment.avatar }}" alt="{{ comment.name }}" loading="lazy"/>
                            </div>
                          </div>
                          <div class="flex-1">
                            <div class="flex items-center justify-between">
                              <h3 class="font-semibold text-primary">{{ comment.name }}</h3>
                              <span class="text-sm text-secondary">{{ comment.published_date | date("MMM d, yyyy h:mma") }}</span>
                            </div>
                            <p class="mt-2 text-base-content/90">{{ comment.text }}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            <div class="drawer-footer border-t border-base-300/20">
              <button type="button" class="btn btn-soft btn-secondary" data-overlay="#overlay-comments">Close</button>
            </div>
          </div>

            <!-- Newsletter Section -->
            <section class="mt-12 pt-8 border-t border-primary/10">
              <div class="card bg-primary/5 border border-primary/10">
                <div class="card-body">
                  <div class="flex flex-col md:flex-row items-center gap-6">
                    <div class="flex-1">
                      <h2 class="text-2xl font-bold text-primary mb-2">Subscribe to our newsletter</h2>
                      <p class="text-base-content/90">Get the latest articles and updates delivered straight to your inbox.</p>
                    </div>
                    <form class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto" onsubmit="return false;">
                      <div class="form-control flex-1">
                        <input 
                        type="email" 
                        placeholder="Enter your email" 
                        class="input input-bordered w-full" 
                        required
                        pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                        title="Please enter a valid email address"
/>
                      </div>
                      <button type="submit" class="btn btn-primary whitespace-nowrap">Subscribe</button>
                    </form>
                  </div>
                </div>
              </div>
            </section>

            <footer class="mt-12 pt-8 border-t border-primary/10">
              <!-- Mobile Author Info -->
              <div class="md:hidden mb-8">
                <div class="card bg-base-200 shadow-base-300/20 shadow-sm">
                  <div class="card-body space-y-6">
                    <!-- Author Info -->
                    <div class="flex items-center space-x-4">
                      <div class="avatar">
                        <div class="w-12 h-12 rounded-full">
                          <img src="https://i.pravatar.cc/150?u={{ author | replace(' ', '+') }}" alt="{{ author }}" onerror="this.src='https://ui-avatars.com/api/?name={{ author | replace(' ', '+') }}&background=random&color=fff&size=150'" loading="lazy"/>
                        </div>
                      </div>
                      <div>
                        <p class="font-semibold text-primary">{{ author }}</p>
                        <p class="text-sm text-secondary">Author</p>
                      </div>
                    </div>

                    <!-- Tags -->
                    {% if tags %}
                      <div class="space-y-2">
                        <h3 class="text-sm font-semibold text-primary">Tags</h3>
                        <div class="flex flex-wrap gap-2">
                          {% for tag in tags %}
                            <span class="badge badge-outline badge-secondary">
                              {{ tag }}
                            </span>
                          {% endfor %}
                        </div>
                      </div>
                    {% endif %}

                    <!-- Share Buttons -->
                    <div class="space-y-2">
                      <h3 class="text-sm font-semibold text-primary">Share</h3>
                      <div class="flex space-x-4">
                        <a href="https://twitter.com/intent/tweet?text={{ title | replace(' ', '+') }}&url={{ page.url | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                          <span class="icon-[tabler--brand-twitter] size-5"></span>
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ page.url | replace(' ', '+') }}&title={{ title | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                          <span class="icon-[tabler--brand-linkedin] size-5"></span>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                          <span class="icon-[tabler--brand-facebook] size-5"></span>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-2 text-sm text-secondary">
                  <span class="icon-[tabler--copyright] size-4 text-primary"></span>
                  <span>{{ published_date | date("YYYY") }}
                    {{ author }}</span>
                </div>
                <div class="flex items-center gap-2 text-sm text-secondary">
                  <span class="icon-[tabler--refresh] size-4 text-primary"></span>
                  {% if updated_date %}
                    <span>Last updated: {{ updated_date | date("MMMM D, YYYY") }}</span>
                  {% else %}
                    <span>Last updated: {{ published_date | date("MMMM D, YYYY") }}</span>
                  {% endif %}
                </div>
                <div class="flex items-center gap-2 text-sm text-secondary">
                  <span class="icon-[tabler--file-text] size-4 text-primary"></span>
                  <span>{% set words = content | wordcount %}{{ words }} words</span>
                </div>
              </div>
            </footer>
          </div>
        </div>

        <!-- Desktop Sidebar -->
        <aside class="hidden md:block w-full md:w-2/5 order-2">
          <div class="sticky top-8 space-y-4">
            <!-- Scrollspy -->
            <div class="card bg-base-200 shadow-base-300/20 shadow-sm">
              <div class="card-body">
                <div class="overflow-y-auto max-h-[calc(100vh-4rem)]">
                  <ul class="menu menu-sm gap-1 bg-base-200" x-data="scrollspy" data-scrollspy="#scrollspy" data-scrollspy-scrollable-parent="#scrollspy">
                    <li class="text-base-content text-xl font-medium">Table of Contents</li>
                    {% for heading in content | toc %}
                      {% if heading.level == 2 %}
                        <li data-scrollspy-group="">
                          <a href="#{{ heading.id }}" 
                           class="text-primary hover:text-primary block py-0.5 font-medium"
                           :class="{ 'scrollspy-active:text-primary': isActive('#{{ heading.id }}') }">
                            {{ heading.text }}
                          </a>
                          {% if heading.children %}
                            <ul>
                              {% for child in heading.children %}
                                <li class="ms-0.5 sm:ms-4">
                                  <a href="#{{ child.id }}" 
                                   class="text-secondary/80 hover:text-primary flex items-center gap-x-2 py-0.5"
                                   :class="{ 'scrollspy-active:text-primary': isActive('#{{ child.id }}') }">
                                    <span class="icon-[tabler--point] size-4 text-secondary"></span>
                                    {{ child.text }}
                                  </a>
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>

            <!-- Article Metadata -->
            <div class="card bg-base-200 shadow-base-300/20 shadow-sm">
              <div class="card-body space-y-6">
                <!-- Author Info -->
                <div class="flex items-center space-x-4">
                  <div class="avatar">
                    <div class="w-12 h-12 rounded-full">
                      <img src="https://i.pravatar.cc/150?u={{ author | replace(' ', '+') }}" alt="{{ author }}" onerror="this.src='https://ui-avatars.com/api/?name={{ author | replace(' ', '+') }}&background=random&color=fff&size=150'" loading="lazy"/>
                    </div>
                  </div>
                  <div>
                    <p class="font-semibold text-primary">{{ author }}</p>
                    <p class="text-sm text-secondary">Author</p>
                  </div>
                </div>

                <!-- Tags -->
                {% if tags %}
                  <div class="space-y-2">
                    <h3 class="text-sm font-semibold text-primary">Tags</h3>
                    <div class="flex flex-wrap gap-2">
                      {% for tag in tags %}
                        <span class="badge badge-outline badge-secondary">
                          {{ tag }}
                        </span>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}

                <!-- Share Buttons -->
                <div class="space-y-2">
                  <h3 class="text-sm font-semibold text-primary">Share</h3>
                  <div class="flex space-x-4">
                    <a href="https://twitter.com/intent/tweet?text={{ title | replace(' ', '+') }}&url={{ page.url | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                      <span class="icon-[tabler--brand-twitter] size-5"></span>
                    </a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ page.url | replace(' ', '+') }}&title={{ title | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                      <span class="icon-[tabler--brand-linkedin] size-5"></span>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | replace(' ', '+') }}" class="text-secondary hover:text-primary transition-colors">
                      <span class="icon-[tabler--brand-facebook] size-5"></span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Mobile Progress Bar -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-base-100 shadow-lg px-4 py-1">
      <div class="flex items-center gap-x-1">
        <template x-for="(step, index) in sectionCount">
          <div class="progress-step bg-primary" role="progressbar" aria-label="Progressbar" :aria-valuenow="progress" aria-valuemin="0" aria-valuemax="100" style="opacity: 0.3;"></div>
        </template>
        <p class="text-xs text-primary ms-1 font-medium" x-text="`${progress}%`"></p>
      </div>
    </div>
  </article>
</div>